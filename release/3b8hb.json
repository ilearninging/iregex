{"id":"171641","urlID":"3b8hb","name":"insert_reserv.php","description":"","content":"<meta http-equiv=\"Content-Type\" content=\"text\/html; charset=utf-8\">\n<?\nputenv(\"NLS_LANG=KOREAN_KOREA.UTF8\");\n\/\/ define error message outputs\nfunction err_print ($e_message) {\n\tprint \"<font color=red>\".$e_message.\"<\/font><p>\";\n}\n\n$conn = oci_connect(\"db2009757091\",\"ce2009757091\", \"course\");\nif (!$conn) {\n\t$e = oci_error();\n\terr_print(\"Connection Failed ...\");\n\tprint htmlentities($e['message']);\n}\n\n$sdate = $year.'-'.$month.'-'.$day;\n\n$query = \"select l.LEGNO lno from leg l, startport s, airport a1, destinationport d, airport a2 where l.LEGNO = s.LEGNO and l.LEGNO = d.LEGNO and s.STARTPORTCODE = a1.AIRPORTCODE and d.DESTINATIONPORTCODE = a2.AIRPORTCODE and a1.city = '$sport' and a2.city = '$dport' and l.STARTDATE > '$sdate'\";\n$stmt = oci_parse($conn,$query);\nif (!$stmt) {\n\t$e = oci_error();\n\terr_print(\"Parsing Failed ...\");\n\tprint htmlentities($e['message']);\n}\n\n\n\n\n$r = oci_execute($stmt);\nif (!$r) {\n\t$e = oci_error();\n\terr_print(\"Execution Failed ...\");\n\tprint htmlentities($e['message']);\n}\n\n$nrows = oci_fetch_all($stmt, $results);\n\nif($nrows > 0) {\n\t\n\t$lno = $results['LNO'][0];\n\t\n\t$query = \"select personno from users u where u.name = '$name'\";\n\t\n\t\t$stmt = oci_parse($conn,$query);\n\t\tif (!$stmt) {\n\t\t\t$e = oci_error();\n\t\t\terr_print(\"Parsing Failed ...\");\n\t\t\tprint htmlentities($e['message']);\n\t\t}\n\n\t\t$r = oci_execute($stmt);\n\t\tif (!$r) {\n\t\t\t$e = oci_error();\n\t\t\terr_print(\"Execution Failed ...\");\n\t\t\tprint htmlentities($e['message']);\n\t\t}\n\n\t\t$nrows = oci_fetch_all($stmt, $results);\n\t\tif($nrows > 0) {\n\t\t\t\t$query = \"select max(reservno) mno from reservation\";\n\t\t\t\n\t\t\t\t$stmt = oci_parse($conn,$query);\n\t\t\t\tif (!$stmt) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Parsing Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\n\n\t\t\t\t$r = oci_execute($stmt);\n\t\t\t\tif (!$r) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Execution Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\n\n\t\t\t\twhile ($row = oci_fetch_array($stmt)) {\n\t\t\t\t\t$mno = $row['MNO'];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$mno = $mno+1;\n\t\t\t\t\n\t\t\t\t$personno = $results['PERSONNO'][0];\n\t\t\t\t\n\t\t\t\t$query = \"insert into reservation values($mno,'$sdate',null,1,'\ud3b8\ub3c4','$personno')\";\n\t\t\t\t\n\t\t\t\t$stmt = oci_parse($conn,$query);\n\t\t\t\tif (!$stmt) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Parsing Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\n\n\t\t\t\t$r = oci_execute($stmt);\n\t\t\t\tif (!$r) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Execution Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t\t$query = \"insert into reservlegs values($mno, $lno)\";\n\t\t\t\t\n\t\t\t\t$stmt = oci_parse($conn,$query);\n\t\t\t\tif (!$stmt) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Parsing Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\n\n\t\t\t\t$r = oci_execute($stmt);\n\t\t\t\tif (!$r) {\n\t\t\t\t\t$e = oci_error();\n\t\t\t\t\terr_print(\"Execution Failed ...\");\n\t\t\t\t\tprint htmlentities($e['message']);\n\t\t\t\t}\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tprint \"\uc608\uc57d\ub4f1\ub85d\uc131\uacf5\";\n\t\t\t\t?>\n\t\t\t\t<form name=\"form\" method=\"post\" action=\"insert_passenger.php\" euctype=\"multipart\/form-data\">\n\t\t\t\t<table>\n\t\t\t\t<tr><th colspan=\"2\">\ud0d1\uc2b9\uc790 \uc815\ubcf4 \uc785\ub825<\/th><\/tr>\n\t","weightedVote":"2.5","numVotes":"0","author":"","community":"1","dateAdded":"2015-06-22","pattern":"\/([A-Z])\\w+\/g","replace":"","state":"{\"substEnabled\":false}"}